From fb038901408d6bd75deebb359f60fdde9c276182 Mon Sep 17 00:00:00 2001
From: Robert Tiemann <r.tiemann@ta-hifi.com>
Date: Tue, 14 Apr 2020 14:39:58 +0200
Subject: [PATCH] ASoC: tahifi-generic: use modern dai_link style

---
 sound/soc/bcm/tahifi-generic.c | 20 +++++++++++---------
 1 file changed, 11 insertions(+), 9 deletions(-)

diff --git a/sound/soc/bcm/tahifi-generic.c b/sound/soc/bcm/tahifi-generic.c
index 04c0620c3f6d..34e523a04422 100644
--- a/sound/soc/bcm/tahifi-generic.c
+++ b/sound/soc/bcm/tahifi-generic.c
@@ -93,7 +93,7 @@ static int tahifi_generic_i2s_format_put(struct snd_kcontrol *kcontrol,
 	if(dai_fmt == dai_link->dai_fmt)
 		return 0;
 
-	rtd = snd_soc_get_pcm_runtime(card, dai_link->name);
+	rtd = snd_soc_get_pcm_runtime(card, dai_link);
 
 	if(rtd->num_codecs < 1)
 		return 0;
@@ -130,16 +130,18 @@ static const struct snd_kcontrol_new elements[] = {
 		     tahifi_generic_i2s_format_put),
 };
 
+SND_SOC_DAILINK_DEFS(tahifi,
+		DAILINK_COMP_ARRAY(COMP_CPU("bcm2708-i2s.0")),
+		DAILINK_COMP_ARRAY(COMP_CODEC("tahifi-codec", "tahifi-i2s")),
+		DAILINK_COMP_ARRAY(COMP_PLATFORM("bcm2708-i2s.0")));
+
 static struct snd_soc_dai_link snd_tahifi_generic_dai[] = {
 	{
 		.name           = "T+A generic HiFi appliance",
 		.stream_name    = "T+A HiFi",
-		.cpu_dai_name   = "bcm2708-i2s.0",
-		.codec_dai_name = "tahifi-i2s",
-		.platform_name  = "bcm2708-i2s.0",
-		.codec_name     = "tahifi-codec",
 		.dai_fmt        = TAHIFI_GENERIC_DAI_FMT_I2S,
 		.ops            = &snd_tahifi_generic_ops,
+		SND_SOC_DAILINK_REG(tahifi),
 	},
 };
 
@@ -176,10 +178,10 @@ static int snd_tahifi_generic_probe(struct platform_device *pdev)
 	i2s_node = of_parse_phandle(pdev->dev.of_node, "i2s-controller", 0);
 
 	if (i2s_node) {
-		dai->cpu_dai_name = NULL;
-		dai->cpu_of_node = i2s_node;
-		dai->platform_name = NULL;
-		dai->platform_of_node = i2s_node;
+		dai->cpus->dai_name = NULL;
+		dai->cpus->of_node = i2s_node;
+		dai->platforms->name = NULL;
+		dai->platforms->of_node = i2s_node;
 	}
 
 	ret = devm_snd_soc_register_card(&pdev->dev, &tahifi_generic_card);
-- 
2.26.1

